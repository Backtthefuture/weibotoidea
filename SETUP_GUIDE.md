# å®šæ—¶ä»»åŠ¡é…ç½®è¯´æ˜

## ğŸ“‹ å·²å®Œæˆçš„å·¥ä½œ

âœ… åˆ›å»ºäº† `run_weibo_agent.py` - Agent SDK æ ¸å¿ƒè„šæœ¬
âœ… åˆ›å»ºäº† `run_scheduled.sh` - å®šæ—¶ä»»åŠ¡å¯åŠ¨è„šæœ¬
âœ… åˆ›å»ºäº† `logs/` - æ—¥å¿—ç›®å½•
âœ… å®‰è£…äº† Claude Agent SDK
âœ… æµ‹è¯•é€šè¿‡ï¼

---

## ğŸš€ å¦‚ä½•è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©è‡ªåŠ¨è¿è¡Œï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Cronï¼ˆæ¨è - ç®€å•ç¨³å®šï¼‰

#### ç¬¬ 1 æ­¥ï¼šç¼–è¾‘ Cron é…ç½®

åœ¨ç»ˆç«¯è¾“å…¥ï¼š

```bash
crontab -e
```

è¿™ä¼šæ‰“å¼€ä¸€ä¸ªç¼–è¾‘å™¨ï¼ˆé€šå¸¸æ˜¯ vim æˆ– nanoï¼‰ã€‚

#### ç¬¬ 2 æ­¥ï¼šæ·»åŠ å®šæ—¶è§„åˆ™

æŒ‰ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ˆå¦‚æœæ˜¯ vimï¼‰ï¼Œç„¶åæ·»åŠ ä»¥ä¸‹ä»»æ„ä¸€è¡Œï¼š

**æ¯å¤©æ—©ä¸Š 8:00 è¿è¡Œï¼š**
```cron
0 8 * * * /Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
```

**æ¯å¤©æ—©ä¸Š 9:00 è¿è¡Œï¼š**
```cron
0 9 * * * /Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
```

**æ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡ï¼š**
```cron
0 */6 * * * /Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
```

**å·¥ä½œæ—¥æ¯å¤©æ—©ä¸Š 8:00ï¼š**
```cron
0 8 * * 1-5 /Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
```

**æ¯å¤©ä¸­åˆ 12:00 å’Œæ™šä¸Š 8:00ï¼š**
```cron
0 12,20 * * * /Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
```

#### ç¬¬ 3 æ­¥ï¼šä¿å­˜å¹¶é€€å‡º

- å¦‚æœæ˜¯ **vim**ï¼šæŒ‰ `Esc`ï¼Œç„¶åè¾“å…¥ `:wq` å›è½¦
- å¦‚æœæ˜¯ **nano**ï¼šæŒ‰ `Ctrl + X`ï¼Œç„¶åæŒ‰ `Y`ï¼Œç„¶åå›è½¦

#### ç¬¬ 4 æ­¥ï¼šéªŒè¯é…ç½®

æŸ¥çœ‹å·²å®‰è£…çš„å®šæ—¶ä»»åŠ¡ï¼š

```bash
crontab -l
```

---

### æ–¹æ³•äºŒï¼šä½¿ç”¨ macOS launchdï¼ˆæ›´ç°ä»£ï¼‰

å¦‚æœä½ æƒ³ç”¨ macOS åŸç”Ÿçš„å®šæ—¶æœåŠ¡ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª plist æ–‡ä»¶ã€‚

#### åˆ›å»º plist æ–‡ä»¶

æ–‡ä»¶è·¯å¾„ï¼š`~/Library/LaunchAgents/com.weibo.hotspot.analyzer.plist`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.weibo.hotspot.analyzer</string>

    <key>ProgramArguments</key>
    <array>
        <string>/Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh</string>
    </array>

    <key>StartCalendarInterval</key>
    <dict>
        <key>Hour</key>
        <integer>8</integer>
        <key>Minute</key>
        <integer>0</integer>
    </dict>

    <key>StandardOutPath</key>
    <string>/Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/logs/launchd.log</string>

    <key>StandardErrorPath</key>
    <string>/Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/logs/launchd.error.log</string>
</dict>
</plist>
```

#### åŠ è½½å®šæ—¶ä»»åŠ¡

```bash
launchctl load ~/Library/LaunchAgents/com.weibo.hotspot.analyzer.plist
```

#### å¸è½½ï¼ˆå¦‚æœéœ€è¦ï¼‰

```bash
launchctl unload ~/Library/LaunchAgents/com.weibo.hotspot.analyzer.plist
```

---

## ğŸ§ª æµ‹è¯•

### æ‰‹åŠ¨æµ‹è¯•è„šæœ¬

åœ¨ç»ˆç«¯è¿è¡Œï¼š

```bash
/Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
```

è¿™ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡åˆ†æï¼Œå¹¶åœ¨ `logs/` ç›®å½•ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æœ€æ–°çš„æ—¥å¿—
ls -lt ~/Documents/å¾®åšçƒ­æœåˆ†æ/logs/

# æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡è¿è¡Œçš„æ—¥å¿—
tail -f ~/Documents/å¾®åšçƒ­æœåˆ†æ/logs/weibo_analysis_*.log
```

---

## ğŸ“Š Cron æ—¶é—´æ ¼å¼è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é’Ÿ (0 - 59)
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å°æ—¶ (0 - 23)
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥æœŸ (1 - 31)
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆä»½ (1 - 12)
â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ˜ŸæœŸ (0 - 7) (0 å’Œ 7 éƒ½æ˜¯å‘¨æ—¥)
â”‚ â”‚ â”‚ â”‚ â”‚
* * * * * è¦æ‰§è¡Œçš„å‘½ä»¤
```

**å¸¸ç”¨ç¤ºä¾‹ï¼š**

| Cron è¡¨è¾¾å¼ | è¯´æ˜ |
|------------|------|
| `0 8 * * *` | æ¯å¤©æ—©ä¸Š 8:00 |
| `0 */6 * * *` | æ¯ 6 å°æ—¶ |
| `30 9 * * 1-5` | å·¥ä½œæ—¥æ—©ä¸Š 9:30 |
| `0 0 * * 0` | æ¯å‘¨æ—¥åˆå¤œ |
| `*/30 * * * *` | æ¯ 30 åˆ†é’Ÿ |

---

## âœ… å®Œæˆåçš„æ•ˆæœ

è®¾ç½®å®Œæˆåï¼š

1. **è‡ªåŠ¨è¿è¡Œ**ï¼šåˆ°äº†è®¾å®šæ—¶é—´ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œ
2. **ç”Ÿæˆæ—¥å¿—**ï¼šæ¯æ¬¡è¿è¡Œéƒ½ä¼šåœ¨ `logs/` ç›®å½•ç”Ÿæˆæ—¥å¿—æ–‡ä»¶
3. **é€šçŸ¥æé†’**ï¼šå¦‚æœä½ çš„ macOS é€šçŸ¥å·²å¼€å¯ï¼Œä¼šæ”¶åˆ°å®Œæˆ/å¤±è´¥é€šçŸ¥
4. **æŠ¥å‘Šè¾“å‡º**ï¼šåˆ†ææŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆåœ¨é¡¹ç›®ç›®å½•

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šCron ä»»åŠ¡æ²¡æœ‰è¿è¡Œ

**è§£å†³æ–¹æ³•ï¼š**

1. ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™ï¼š
   ```bash
   chmod +x /Users/superhuang/Documents/å¾®åšçƒ­æœåˆ†æ/run_scheduled.sh
   ```

2. æ£€æŸ¥ Cron æ—¥å¿—ï¼š
   ```bash
   log stream --predicate 'process == "cron"' --level debug
   ```

3. ç¡®ä¿è·¯å¾„æ˜¯ç»å¯¹è·¯å¾„ï¼ˆä¸è¦ç”¨ `~`ï¼‰

### é—®é¢˜ï¼šæ”¶ä¸åˆ°é€šçŸ¥

macOS å¯èƒ½éœ€è¦æˆæƒ Terminal å‘é€é€šçŸ¥ï¼š

1. æ‰“å¼€ **ç³»ç»Ÿåå¥½è®¾ç½®** â†’ **é€šçŸ¥ä¸ä¸“æ³¨æ¨¡å¼**
2. æ‰¾åˆ° **ç»ˆç«¯** æˆ– **è„šæœ¬ç¼–è¾‘å™¨**
3. å¯ç”¨ **å…è®¸é€šçŸ¥**

---

## ğŸ“ ä¸‹ä¸€æ­¥

é€‰æ‹©ä½ å–œæ¬¢çš„æ–¹å¼è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š

- **æ¨èæ–°æ‰‹**ï¼šä½¿ç”¨ Cronï¼ˆæ–¹æ³•ä¸€ï¼‰
- **æƒ³è¦æ›´å¤šæ§åˆ¶**ï¼šä½¿ç”¨ launchdï¼ˆæ–¹æ³•äºŒï¼‰

è®¾ç½®å®Œæˆåï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è§¦å‘æ—¶é—´ï¼Œæˆ–è€…æ‰‹åŠ¨è¿è¡Œæµ‹è¯•ï¼
